/*
 * This Source Code Form is subject to the terms of the Mozilla Public
 * License, v. 2.0. If a copy of the MPL was not distributed with this
 * file, You can obtain one at https://mozilla.org/MPL/2.0/.
 *
 * Copyright (c) 2023-present, Ukama Inc.
 */

syntax = "proto3";

option go_package = "github.com/ukama/ukama/systems/messaging/nns/pb/gen";
package ukama.messaging.nns.v1;
import "validator.proto";

service Nns { // The Node Name Service (like DNS)
    rpc GetNode(GetNodeRequest) returns (GetNodeResponse);
    rpc GetMesh(GetMeshRequest) returns (GetMeshResponse);
    rpc Set(SetRequest) returns (SetResponse);
    rpc UpdateMesh(UpdateMeshRequest) returns (UpdateMeshResponse);
    rpc UpdateNode(UpdateNodeRequest) returns (UpdateNodeResponse);
    rpc Delete(DeleteRequest) returns (DeleteResponse);
    rpc List(ListRequest) returns (ListResponse);
}   

message GetNodeRequest{
    string nodeId = 1 [(validator.field) = { string_not_empty: true}];
}

message GetNodeResponse{
    string nodeId = 1;  
    string nodeIp = 2;
    int32 nodePort = 3;
}

message GetMeshRequest { }

message GetMeshResponse{
    string meshIp = 1;
    int32 meshPort = 2;
}

message SetRequest{
    string nodeId = 1  [(validator.field) = { string_not_empty: true}];
    string nodeIp = 2  [(validator.field) = { string_not_empty: true,  regex: "^(([0-9]|[1-9][0-9]|1[0-9]{2}|2[0-4][0-9]|25[0-5])\\.){3}([0-9]|[1-9][0-9]|1[0-9]{2}|2[0-4][0-9]|25[0-5])$"}];
    string meshIp = 3  [(validator.field) =  { string_not_empty: true,  regex: "^(([0-9]|[1-9][0-9]|1[0-9]{2}|2[0-4][0-9]|25[0-5])\\.){3}([0-9]|[1-9][0-9]|1[0-9]{2}|2[0-4][0-9]|25[0-5])$"}];
    int32 nodePort = 4;
    int32 meshPort = 5;
    string site = 6;
    string network = 7;
    string meshHostName = 8;
}

message SetResponse { }

message UpdateMeshRequest{
    string meshIp = 1 [(validator.field) = { string_not_empty: true}];
    int32 meshPort = 2 [(validator.field) = { string_not_empty: true}];;
}

message UpdateMeshResponse { }

message UpdateNodeRequest{
    string nodeId = 1 [(validator.field) = { string_not_empty: true}];
    string nodeIp = 2 [(validator.field) = { string_not_empty: true}];
    int32 nodePort = 3 [(validator.field) = { string_not_empty: true}];
}

message UpdateNodeResponse { }

message DeleteRequest{
    string nodeId = 1 [(validator.field) = { string_not_empty: true}];
}

message DeleteResponse { }


message OrgMap {
    string nodeId = 1  [(validator.field) = { string_not_empty: true}];
    string nodeIp = 2  [(validator.field) = { string_not_empty: true,  regex: "^(([0-9]|[1-9][0-9]|1[0-9]{2}|2[0-4][0-9]|25[0-5])\\.){3}([0-9]|[1-9][0-9]|1[0-9]{2}|2[0-4][0-9]|25[0-5])$"}];
    int32 nodePort = 3;
    int32 meshPort = 4;
    string org = 5;
    string network = 6;
    string site = 7;
    string meshIp = 8;
    string meshHostName = 9;
}

message ListRequest { }

message ListResponse {
    repeated OrgMap list  = 1;
}

