# Api-gateway

Api-gateway is a Rest interface of Ukama cloud for user facing apps: frontend, mobile or API consumers


## Run Locally

- Start docker-compose with dependencies. Make sure that all service images are up-to-date 

`docker-compose -f docker-compose.deps.yaml up`

- enable debug mode and bypass authentication. You still have to provide empty token or authorization header   
```
export DEBUGMODE=true
export BYPASSAUTHMODE=true
```
- Run service

`go run ./cmd/main.go`

- Test request
`curl -s -X GET  -H "token: bearer token"  http://localhost:8080/orgs/org-1`

### Calling Api 
In order to use API you need to have either token or cookie. Cookie is generated by our auth app when user logs in. You can generate a token by calling [kratos-login.sh](kratos-login.sh) script providing valid credentials.

You can generate a token by calling [kratos-login.sh](kratos-login.sh) script providing 
To use API without a browser:

```
DOMAIN="ukama.com"
EMAIL=UkamaUser@example.com
PASSWORD=YOUR_PASS

actionUrl=$(curl -s -X GET -H "Accept: application/json" "https://auth.$DOMAIN/.api/self-service/login/api" | jq -r '.ui.action')

echo $actionUrl
TOKEN=$(curl -s -X POST -H  "Accept: application/json" -H "Content-Type: application/json" \
    -d "{\"password_identifier\": \"${EMAIL}\", \"password\": \"${PASSWORD}\", \"method\": \"password\"}" \
    "$actionUrl" | jq -r '.session_token')
echo Org: $TOKEN

# Get default org ID for a user
ORG=$(curl --request GET \
  --url https://auth.$DOMAIN/.api/sessions/whoami \
  --header "X-Session-Token: ${TOKEN}" | jq -r '.identity.id')
echo Org: $ORG

# Call nodes endpoint
curl --request GET \
  --url https://api.$DOMAIN/orgs/$ORG/nodes \
  --header "Authorization: Bearer ${TOKEN}"
```